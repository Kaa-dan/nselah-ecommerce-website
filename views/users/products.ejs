<%- include ('../layouts/userHeader.ejs') %>



















<style>
    * {
    box-sizing: border-box
}

#search {
    outline: none;
    border: none;
    display: inline-block
}

#burgundy {
    color: rgb(153, 40, 59)
}

#orange,
select,
.btn {
    color: orange
}

.fa-search {
    font-size: 20px;
    padding: 10px;
    margin-bottom: 3px;
    padding-right: 20px
}

.search-nav-item {
    height: 40px
}

nav {
    padding: 0px 100px
}

.fa-user-o,
.fa-shopping-cart {
    font-size: 20px;
    padding: 4px
}

.form-group {
    margin-bottom: 5px
}

label {
    padding-left: 10px
}

.form-group:last-child {
    margin-bottom: 0
}

h6 {
    margin-bottom: 0px
}

#sort {
    outline: none;
    border: none
}

.btn {
    border: 1px solid orange;
    border-radius: 10px;
    background-color: #fff
}

.btn:hover {
    color: #fff;
    background-color: orange
}

.card-body {
    padding: 8px
}

.sign {
    width: 25px;
    height: 25px
}

.discount {
    border: 1px solid orange;
    border-radius: 5px;
    width: 65px;
    position: absolute;
    top: 2%
}

@media(min-width:1200px) {
    #search {
        width: 300px;
        padding: 5px;
        padding-left: 20px
    }

    .search-nav-item {
        margin-left: 400px;
        width: 350px
    }

    .fa-user-o {
        margin-left: 300px
    }

    .text {
        display: none
    }

    .fa-user-o,
    .fa-shopping-cart {
        font-size: 20px;
        padding-left: 20px
    }

    #sidebar {
        width: 30%;
        padding: 20px;
        float: left
    }

    #products {
        width: 70%;
        padding: 10px;
        margin: 0;
        float: right
    }

    .card {
        width: 300px;
        height: 330px;
        border: none
    }

    .card-img-top {
        width: 295px;
        height: 200px;
        border-radius: 10px
    }

    del {
        padding-right: 2px
    }

    .filter,
    #mobile-filter {
        display: none
    }
}

@media(min-width:992px) and (max-width:1199px) {
    #search {
        width: 300px;
        padding: 5px;
        padding-left: 20px
    }

    .search-nav-item {
        margin-left: 200px;
        width: 350px
    }

    .fa-user-o {
        margin-left: 160px
    }

    .text {
        display: none
    }

    #sidebar {
        width: 30%;
        padding: 20px;
        float: left
    }

    #products {
        width: 70%;
        padding: 10px;
        margin: 0;
        float: right
    }

    .card {
        width: 200px;
        height: 330px;
        border: none
    }

    .card-img-top {
        width: 200px;
        height: 200px;
        border-radius: 10px
    }

    .fa-plus,
    .fa-minus {
        font-size: 12px
    }

    .sign {
        height: 25px
    }

    .price {
        width: 99px
    }

    .filter,
    #mobile-filter {
        display: none
    }
}

@media(min-width:768px) and (max-width:991px) {
    #search {
        width: 300px;
        padding: 5px;
        padding-left: 20px
    }

    .search-nav-item {
        margin-left: 60px;
        width: 350px
    }

    .fa-user-o {
        margin-left: 80px
    }

    .text {
        display: none
    }

    #sidebar {
        width: 35%;
        padding: 20px;
        float: left
    }

    #products {
        width: 65%;
        padding: 10px;
        margin: 0;
        float: right
    }

    .card {
        border: none
    }

    .filter,
    #mobile-filter {
        display: none
    }
}

@media(min-width:576px) and (max-width:767px) {
    .text {
        display: none
    }

    .search-nav-item {
        margin-left: 35px;
        width: 270px
    }

    #search {
        width: 240px;
        padding: 5px;
        padding-left: 20px
    }

    .fa-search {
        padding: 3px;
        font-size: 18px
    }

    #sidebar {
        width: 40%;
        padding: 20px;
        float: left
    }

    #products {
        width: 60%;
        padding: 10px;
        margin: 0;
        float: right
    }

    .card {
        border: none
    }

    #off {
        padding-left: 2px
    }

    #sorting span,
    #res {
        font-size: 14px
    }

    .filter,
    #mobile-filter {
        display: none
    }
}

@media(max-width:575px) {
    .search-nav-item {
        margin: 0;
        width: 100%;
        margin-top: 10px
    }

    #search {
        width: 80%;
        padding-left: 10px;
        margin-top: 10px;
        padding-right: 10px
    }

    .fa-search {
        padding: 10px;
        font-size: 18px
    }

    #sidebar {
        display: none
    }

    .filter {
        margin-left: 70%;
        margin-top: 2%
    }

    #sorting,
    #res {
        font-size: 12px;
        margin-top: 2%
    }
}
</style>











<nav class="navbar navbar-expand-sm navbar-light bg-white border-bottom"> <a class="navbar-brand ml-2 font-weight-bold" href="#"><span id="burgundy">WI</span><span id="orange">NES</span></a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor" aria-controls="navbarColor" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
    <div class="collapse navbar-collapse" id="navbarColor">
        <ul class="navbar-nav">
            <li class="nav-item rounded bg-light search-nav-item"><input type="text" id="search" name="search" onkeyup="update()" class="bg-light" placeholder="Search "><span class="fa fa-search text-muted"></span></li>
           
        </ul>
    </div>
</nav>
<div class="filter"> <button class="btn btn-default" type="button" data-toggle="collapse" data-target="#mobile-filter" aria-expanded="true" aria-controls="mobile-filter">Filters<span class="fa fa-filter pl-1"></span></button>
</div>
<div id="mobile-filter">
    <p class="pl-sm-0 pl-2"> Home | <b>All</b></p>
    <div class="border-bottom pb-2 ml-2">
        <h4 id="burgundy">Filters</h4>
    </div>
    <div class="py-2 border-bottom ml-3">
        <h6 class="font-weight-bold">Categories</h6>
        <div id="orange"><span class="fa fa-minus"></span></div>
       
            <% for ( i=0;i<category.length;i++){%>
            <div class="form-group"> <input type="checkbox" id="artisan" value="<%-i%>" class="category" onchange="update()" name="category"> <label for="artisan"><%-category[i].name%></label> </div>
           
           
            <%}%>
        
    </div>
    <div class="py-2 border-bottom ml-3">
        <h6 class="font-weight-bold">Price</h6>
        <div id="orange"><span class="fa fa-minus"></span></div>
       
            <div class="form-group"> <input class="sort" checked name="sort" onchange="update()" value="0" type="radio" id="tea"> <label for="tea">Latest Arrivals</label> </div>
            <div class="form-group"> <input class="sort" name="sort" onchange="update()" value="1" type="radio" id="cookies"> <label for="cookies">Low to High</label> </div>
            <div class="form-group"> <input class="sort" name="sort" onchange="update()" value="-1" type="radio" id="pastries"> <label for="pastries">High to Low</label> </div>
           
         
    </div>
  
</div>
<!-- Sidebar filter section -->
<section id="sidebar">
    <p> Home | <b>All </b></p>
    <div class="border-bottom pb-2 ml-2 mr-0">
        <h4 id="burgundy">Filters</h4>
    </div>
    <div class="py-2 border-bottom ml-3">
        <h6 class="font-weight-bold">Categories</h6>
        <div id="orange"><span class="fa fa-minus"></span></div>
       
            <% for ( i=0;i<category.length;i++){%>
                <div class="form-group"> <input type="checkbox" id="artisan" value="<%-i%>" class="category" onchange="update()"  name="category"> <label for="artisan"><%-category[i].name%></label> </div>
               
               
                <%}%>
      
    </div>
    <div class="py-2 border-bottom ml-3">
        <h6 class="font-weight-bold">Price</h6>
        <div id="orange"><span class="fa fa-minus"></span></div>
       
            <div class="form-group"> <input class="sort" checked name="sort" onchange="update()" value="0" type="radio" id="tea"> <label for="tea">Latest Arrivals</label> </div>
            <div class="form-group"> <input class="sort" name="sort" onchange="update()" value="1" type="radio" id="cookies"> <label for="cookies">Low to High</label> </div>
            <div class="form-group"> <input class="sort" name="sort" onchange="update()" value="-1" type="radio" id="pastries"> <label for="pastries">High to Low</label> </div>
           
         
    </div>
   
</section>
<!-- products section -->

<!-- Product Section Begin -->
<section class="product spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 col-md-4">
                <div class="section-title">
                    <h4>Products</h4>
                </div>
            </div>
           
        </div>
        
        <div class="row property__gallery" id="mainProducts">
            
            <% if(product){
                for(i=0;i<product.length;i++){ %>
            <div class="col-lg-4 col-md-6 col-sm-6 ">
                <div class="product__item sale">
                    <div class="product__item__pic" style="background-image:url('/uploads/<%-product[i].image[0]%>');background-size: 100% 100%  ">
                        <div class="label">Sale</div>
                        <ul class="product__hover">
                         
                            <li><a href="/productDetail?id=<%=product[i]._id%>" ><span class="arrow_expand"></span></a></li>
                            <li><a href="/addToWishList?id=<%-product[i]._id%>"><span class="icon_heart_alt"></span></a></li>
                            <%if(product[i].stock<=0){%>

                                <li><span style="color: red; background-color: white;" >OutOfStock</span></li>
                                <%}else{%>
                            
                            <li><a href="/addToCart?id=<%-product[i]._id%>"><span class="icon_bag_alt"></span></a></li>
                            <%}%>
                        </ul>
                    </div>

                    <%if(product[i].offer>0){%>
                        <div class="product__item__text">
                            <h6><a href="#"><%-product[i].name%></a></h6>
                            <div class="product__price">₹ <%-product[i].price%><span style="color:blue;">₹ <%-product[i].finalPrice%></span></div>
                            <h6 style="color: green;"><%-product[i].offer%>% off</h6>
                        </div>

                        <%}else{%>
                    <div class="product__item__text">
                        <h6><a href="#"><%-product[i].name%></a></h6>
                        <div class="product__price">₹ <%-product[i].price%><span></span></div>
                    </div>
                    <%}%>
                </div>
            </div>
            <%}}%>
        </div>
        <div style="background-color: rgb(151, 151, 222);">
            <nav  id="pagnation" aria-label="Page navigation example">
                <% if(pageCount > 1){ %>
                <ul class="pagination">
                    <% for(i=0;i<pageCount;i++){%> 
                  <li  class="page-item  pagnation <% if(page == i){ %>is-active<%}%>" id="<%-i%>"  ><a " onclick="updatePage('<%-i%>')" class="page-link   <% if(page != i){ %>text-white<%}else{%>text-danger<%}%>" href="#"><%-i+1%></a></li>
                  
                  <% }%>
                </ul>
                <%}%>
              </nav>
        </div>

        

      




    </div>
</section>
<!-- Product Section End -->

<script>
    let page = 0
            function updatePage(pg=0){
                page = pg
                console.log(page);
                pageNo=document.getElementsByClassName('pagnation')
                for(let key of pageNo){key.classList.remove('is-active')}
                document.getElementById(page).classList.add('is-active')
                update()
            }
    function update(){
        var elements = document.getElementsByClassName("category");
        var sortvalues = document.getElementsByClassName('sort')
        var search = document.getElementById('search').value
var arr = '';
for(var i = 0; i < elements.length; i++) {
if(elements[i].checked){
      arr = [...arr,elements[i].value] 
}}
let sort
for(var i = 0; i < sortvalues.length; i++) {
if(sortvalues[i].checked){
     sort = sortvalues[i].value 
}}
        console.log(arr+'\n'+sort+'\n'+search+'\n'+page);
        console.log('called');
      $.ajax({
        url: '/products',
        type: 'GET',
        data:{category:arr ,sort:sort,search:search,page:page ,ajax:true},
        success: function(data) {
          console.log(data);
          if(data.pageCount ==1){
    document.getElementById('pagnation').style.display='none';
          }else{
            document.getElementById('pagnation').style.display='block';
    }
    product = data.products

    let productItems = "";
    if (product) {
  for (let i = 0; i < product.length; i++) {
     productItems += `
      <div class="col-lg-4 col-md-6 col-sm-6 ">
        <div class="product__item sale">
          <div class="product__item__pic" style="background-image:url('/uploads/${product[i].image[0]}');background-size: 100% 100%">
            <div class="label">Sale</div>
            <ul class="product__hover">
              <li><a href="/productDetail?id=${product[i]._id}"><span class="arrow_expand"></span></a></li>
              <li><a href="/addToWishList?id=${product[i]._id}"><span class="icon_heart_alt"></span></a></li>
              ${product[i].stock <= 0 ? `
                <li><span style="color: red; background-color: white;">OutOfStock</span></li>
              ` : `
                <li><a href="/addToCart?id=${product[i]._id}"><span class="icon_bag_alt"></span></a></li>
              `}
            </ul>
          </div>
          ${product[i].offer > 0 ? `
            <div class="product__item__text">
              <h6><a href="#">${product[i].name}</a></h6>
              <div class="product__price">₹ ${product[i].price}<span style="color:blue;">₹ ${product[i].finalPrice}</span></div>
              <h6 style="color: green;">${product[i].offer}% off</h6>
            </div>
          ` : `
            <div class="product__item__text">
              <h6><a href="#">${product[i].name}</a></h6>
              <div class="product__price">₹ ${product[i].price}<span></span></div>
            </div>
          `}
        </div>
      </div>
    `;
    // Manipulate the DOM with the productItem variable here
  }
}




document.getElementById('mainProducts').innerHTML = productItems
  
if (data.pageCount > 1) {
let pagination = "";
if(data.pageCount > 1){
  pagination += `<ul class="pagination">`;
  for(let i=0; i<data.pageCount; i++){
    pagination += `<li class="page-item  pagnation ${page == i ? 'is-active' : ''}" id="${i}"><a onclick="updatePage('${i}')" class="page-link ${page != i ? 'text-white' : 'text-danger'}" href="#">${i+1}</a></li>`;
  }
  pagination += `</ul>`;
}
document.getElementById('pagnation').innerHTML  = pagination

}else{
if(data.page!=0){
updatePage()
}
}


        }
      });
    }
  </script> 





<%- include ('../layouts/userfooter.ejs') %>